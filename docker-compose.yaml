version: "2"

volumes:
  database:

services:
  adserver:
    image: adshares/adserver:dev
    build:
      context: ./docker
      dockerfile: ./dockerfile
    working_dir: /adserver
    volumes:
    - .:/adserver
    env_file:
      - docker-compose.dev.env

  dev:
    image: pawzar/devops:php-fpm
    working_dir: /adserver
    volumes:
    - .:/adserver
    command: ['php','artisan','queue:work']
    user: ${SYSTEM_USER_ID}

  webserver:
    image: nginx:alpine
    working_dir: /adserver/public
    volumes:
    - ./docker/nginx.conf:/etc/nginx/conf.d/default.conf
    - ./public:/adserver/public

  database:
    image: mysql:8.0
    environment:
    - MYSQL_ROOT_PASSWORD=adshares
    - MYSQL_DATABASE=adserver
    - MYSQL_USER=adserver
    - MYSQL_PASSWORD=adserver
    volumes:
      - database:/var/lib/mysql

  mailer:
    image: mailhog/mailhog:latest
    user: ${SYSTEM_USER_ID}

